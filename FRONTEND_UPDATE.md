# 前端更新说明 - 新协议架构支持

## 🚀 新增功能

### 1. 协议选择器组件
- **位置**: `frontend/src/components/protocol/protocol-selector.tsx`
- **功能**: 提供统一的协议选择界面，支持所有工业协议
- **支持的协议**:
  - ModbusTCP
  - ModbusRTU
  - ModbusRtuOverTCP
  - 欧姆龙FINS
  - 西门子S7

### 2. 设备状态监控页面
- **位置**: `frontend/src/app/devices/status/page.tsx`
- **功能**: 实时显示所有设备的连接状态和协议信息
- **特性**:
  - 按协议分组显示设备
  - 实时连接状态监控
  - 协议库状态检查
  - 错误信息展示

### 3. 协议状态组件
- **位置**: `frontend/src/components/protocol/protocol-status.tsx`
- **功能**: 显示设备连接状态和协议库信息
- **特性**:
  - 设备在线/离线状态
  - 协议连接率统计
  - 详细设备信息提示

### 4. 地址格式帮助
- **位置**: `protocol-selector.tsx` 中的 `AddressFormatHelp` 组件
- **功能**: 根据选择的协议类型显示相应的地址格式示例

## 📋 前端需要的调整

### 1. 现有设备页面的改进

#### 设备表单
- 使用新的 `DeviceForm` 组件 (`frontend/src/components/device/device-form.tsx`)
- 集成 `ProtocolSelector` 组件
- 根据协议类型动态显示相应配置项

#### API 服务
- 新增 `getAllDeviceStatus()` 方法
- 新增 `getProtocolInfo()` 方法
- 更新设备状态相关接口

### 2. 导航菜单更新
- 在侧边栏添加"设备状态"菜单项
- 路径: `/devices/status`

## 🔧 使用方法

### 1. 添加新设备

```tsx
// 在设备表单中使用新的协议选择器
<DeviceForm
  groups={groups}
  onSubmit={handleSubmit}
  onCancel={handleCancel}
  loading={loading}
/>
```

### 2. 查看设备状态

访问 `/devices/status` 页面查看：
- 所有设备的实时连接状态
- 按协议分组的设备列表
- 协议库的可用性状态
- 详细的设备连接信息

### 3. 协议配置

在添加/编辑设备时：
1. 选择协议类型
2. 根据协议类型配置相应参数
3. 系统自动提供地址格式帮助

## 📊 协议类型和配置

### ModbusTCP
- **默认端口**: 502
- **必需参数**: IP地址、站号
- **可选参数**: 数据格式

### ModbusRTU
- **必需参数**: 串口、波特率、站号
- **可选参数**: 数据位、校验位、停止位

### ModbusRtuOverTCP
- **默认端口**: 502
- **必需参数**: IP地址、站号

### 欧姆龙FINS
- **默认端口**: 9600
- **必需参数**: IP地址、PLC系列
- **可选参数**: 网络节点号

### 西门子S7
- **默认端口**: 102
- **必需参数**: IP地址、PLC系列
- **可选参数**: 机架号、插槽号

## 🎯 地址格式示例

### Modbus协议
- `"100"` - 简单保持寄存器
- `"s=1;100"` - 站号1的保持寄存器
- `"x=3;100"` - 功能码03，地址100
- `"s=2;x=4;100"` - 站号2，功能码04

### 欧姆龙FINS
- `"D100"` - 数据寄存器
- `"CIO100"` - CIO区
- `"W100"` - 工作区

### 西门子S7
- `"M100.0"` - 位地址
- `"MW100"` - 字地址
- `"DB1.DBW0"` - 数据块字地址

## 🔄 自动检测

前端会自动：
- 检测协议库可用性
- 根据协议类型显示相应配置
- 提供地址格式帮助
- 实时更新设备状态

## 📱 用户体验改进

1. **智能协议识别** - 系统自动识别设备协议类型
2. **动态配置界面** - 根据协议类型显示相应配置项
3. **实时状态监控** - 自动刷新设备连接状态
4. **详细帮助信息** - 提供协议和地址格式说明
5. **错误提示** - 友好的错误信息和建议

## 🎨 视觉特性

- 协议类型图标和颜色区分
- 连接状态的直观显示
- 响应式布局适配
- 详细的工具提示信息
- 实时数据更新动画

## 📝 开发者注意事项

1. **组件复用** - 新的协议组件可以在其他页面复用
2. **类型安全** - 使用TypeScript确保类型安全
3. **错误处理** - 完善的错误处理和用户提示
4. **性能优化** - 合理的数据刷新频率和缓存策略

## 🚀 后续计划

1. 添加更多协议支持
2. 优化设备批量操作
3. 增强协议测试功能
4. 添加配置模板功能
5. 支持自定义协议扩展